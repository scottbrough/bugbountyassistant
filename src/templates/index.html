<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Bounty Assistant v3.0</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .hunt-progress {
            transition: width 0.5s ease-in-out;
        }
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // API Base URL
        const API_BASE = 'http://localhost:5000/api';
        
        // Socket.IO connection
        const socket = io('http://localhost:5000');

        // Main App Component
        function App() {
            const [activeView, setActiveView] = useState('dashboard');
            const [user, setUser] = useState({ name: 'Bug Hunter' });
            const [notifications, setNotifications] = useState([]);

            useEffect(() => {
                // Socket.IO event listeners
                socket.on('connected', (data) => {
                    console.log('Connected to server:', data);
                });

                socket.on('hunt_progress', (data) => {
                    console.log('Hunt progress:', data);
                });

                socket.on('hunt_complete', (data) => {
                    addNotification('success', `Hunt completed! Found ${data.findings_count} vulnerabilities.`);
                });

                return () => {
                    socket.off('connected');
                    socket.off('hunt_progress');
                    socket.off('hunt_complete');
                };
            }, []);

            const addNotification = (type, message) => {
                const notification = {
                    id: Date.now(),
                    type,
                    message,
                    timestamp: new Date()
                };
                setNotifications(prev => [notification, ...prev].slice(0, 10));
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    <Navbar 
                        activeView={activeView} 
                        setActiveView={setActiveView}
                        notifications={notifications}
                    />
                    
                    <main className="container mx-auto px-4 py-8">
                        {activeView === 'dashboard' && <Dashboard />}
                        {activeView === 'hunt' && <HuntManager addNotification={addNotification} />}
                        {activeView === 'findings' && <FindingsView />}
                        {activeView === 'revenue' && <RevenueAnalytics />}
                        {activeView === 'monitoring' && <MonitoringView />}
                        {activeView === 'settings' && <SettingsView />}
                    </main>
                </div>
            );
        }

        // Navigation Component
        function Navbar({ activeView, setActiveView, notifications }) {
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'fa-gauge' },
                { id: 'hunt', label: 'Hunt', icon: 'fa-crosshairs' },
                { id: 'findings', label: 'Findings', icon: 'fa-bug' },
                { id: 'revenue', label: 'Revenue', icon: 'fa-dollar-sign' },
                { id: 'monitoring', label: 'Monitor', icon: 'fa-eye' },
                { id: 'settings', label: 'Settings', icon: 'fa-gear' }
            ];

            return (
                <nav className="gradient-bg text-white shadow-lg">
                    <div className="container mx-auto px-4">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center space-x-8">
                                <div className="flex items-center space-x-2">
                                    <i className="fas fa-shield-alt text-2xl"></i>
                                    <span className="text-xl font-bold">BB Assistant v3</span>
                                </div>
                                
                                <div className="flex space-x-4">
                                    {navItems.map(item => (
                                        <button
                                            key={item.id}
                                            onClick={() => setActiveView(item.id)}
                                            className={`px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                                                activeView === item.id 
                                                    ? 'bg-white bg-opacity-20' 
                                                    : 'hover:bg-white hover:bg-opacity-10'
                                            }`}
                                        >
                                            <i className={`fas ${item.icon} mr-2`}></i>
                                            {item.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="flex items-center space-x-4">
                                <NotificationBell notifications={notifications} />
                                <div className="flex items-center space-x-2">
                                    <i className="fas fa-user-circle text-2xl"></i>
                                    <span>Bug Hunter</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </nav>
            );
        }

        // Notification Bell Component
        function NotificationBell({ notifications }) {
            const [showDropdown, setShowDropdown] = useState(false);
            const unreadCount = notifications.filter(n => !n.read).length;

            return (
                <div className="relative">
                    <button
                        onClick={() => setShowDropdown(!showDropdown)}
                        className="relative p-2 hover:bg-white hover:bg-opacity-10 rounded-full transition-colors"
                    >
                        <i className="fas fa-bell text-xl"></i>
                        {unreadCount > 0 && (
                            <span className="absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
                                {unreadCount}
                            </span>
                        )}
                    </button>
                    
                    {showDropdown && (
                        <div className="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-xl z-50 text-gray-800">
                            <div className="px-4 py-3 border-b">
                                <h3 className="font-semibold">Notifications</h3>
                            </div>
                            <div className="max-h-96 overflow-y-auto">
                                {notifications.length === 0 ? (
                                    <div className="px-4 py-8 text-center text-gray-500">
                                        No notifications yet
                                    </div>
                                ) : (
                                    notifications.map(notification => (
                                        <div key={notification.id} className="px-4 py-3 hover:bg-gray-50 border-b">
                                            <div className="flex items-start space-x-3">
                                                <i className={`fas fa-${notification.type === 'success' ? 'check-circle text-green-500' : 'info-circle text-blue-500'} mt-1`}></i>
                                                <div className="flex-1">
                                                    <p className="text-sm">{notification.message}</p>
                                                    <p className="text-xs text-gray-500 mt-1">
                                                        {new Date(notification.timestamp).toLocaleTimeString()}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Dashboard Component
        function Dashboard() {
            const [stats, setStats] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchDashboardData();
            }, []);

            const fetchDashboardData = async () => {
                try {
                    const response = await fetch(`${API_BASE}/dashboard`);
                    const data = await response.json();
                    if (data.success) {
                        setStats(data.data);
                    }
                } catch (error) {
                    console.error('Failed to fetch dashboard data:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return <LoadingSpinner />;
            }

            return (
                <div>
                    <h1 className="text-3xl font-bold mb-8">Dashboard</h1>
                    
                    {/* Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <StatCard
                            title="Total Earnings"
                            value={`$${stats?.total_earnings?.toFixed(2) || '0.00'}`}
                            icon="fa-dollar-sign"
                            color="green"
                        />
                        <StatCard
                            title="Hourly Rate"
                            value={`$${stats?.hourly_rate?.toFixed(2) || '0.00'}/hr`}
                            icon="fa-clock"
                            color="blue"
                        />
                        <StatCard
                            title="Success Rate"
                            value={`${(stats?.success_rate * 100)?.toFixed(1) || '0'}%`}
                            icon="fa-chart-line"
                            color="purple"
                        />
                        <StatCard
                            title="Active Hunts"
                            value={stats?.active_hunts || '0'}
                            icon="fa-crosshairs"
                            color="orange"
                        />
                    </div>

                    {/* Charts Section */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-semibold mb-4">Top Earning Vulnerability Types</h2>
                            <VulnTypeChart data={stats?.top_earning_types || []} />
                        </div>
                        
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-semibold mb-4">Platform Earnings</h2>
                            <PlatformChart data={stats?.platform_earnings || {}} />
                        </div>
                    </div>

                    {/* Recent Activity */}
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h2 className="text-xl font-semibold mb-4">Recent Activity</h2>
                        <div className="space-y-3">
                            <ActivityItem
                                icon="fa-bug"
                                title="XSS vulnerability found"
                                description="example.com - High severity"
                                time="2 hours ago"
                            />
                            <ActivityItem
                                icon="fa-check-circle"
                                title="Report accepted"
                                description="SQL Injection on api.target.com - $500 bounty"
                                time="1 day ago"
                            />
                            <ActivityItem
                                icon="fa-eye"
                                title="New endpoints detected"
                                description="monitoring.target.com - 5 new endpoints"
                                time="3 days ago"
                            />
                        </div>
                    </div>
                </div>
            );
        }

        // Hunt Manager Component
        function HuntManager({ addNotification }) {
            const [activeHunts, setActiveHunts] = useState([]);
            const [showNewHunt, setShowNewHunt] = useState(false);

            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-3xl font-bold">Hunt Manager</h1>
                        <button
                            onClick={() => setShowNewHunt(true)}
                            className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2"
                        >
                            <i className="fas fa-plus"></i>
                            <span>New Hunt</span>
                        </button>
                    </div>

                    {showNewHunt && (
                        <NewHuntModal
                            onClose={() => setShowNewHunt(false)}
                            onStart={(huntData) => {
                                setShowNewHunt(false);
                                startNewHunt(huntData, addNotification);
                            }}
                        />
                    )}

                    {/* Active Hunts */}
                    <div className="space-y-4">
                        {activeHunts.length === 0 ? (
                            <div className="bg-white rounded-lg shadow-lg p-8 text-center">
                                <i className="fas fa-crosshairs text-6xl text-gray-300 mb-4"></i>
                                <p className="text-gray-500 text-lg">No active hunts</p>
                                <p className="text-gray-400">Start a new hunt to begin testing targets</p>
                            </div>
                        ) : (
                            activeHunts.map(hunt => (
                                <HuntCard key={hunt.id} hunt={hunt} />
                            ))
                        )}
                    </div>
                </div>
            );
        }

        // New Hunt Modal Component
        function NewHuntModal({ onClose, onStart }) {
            const [target, setTarget] = useState('');
            const [platform, setPlatform] = useState('');
            const [program, setProgram] = useState('');
            const [config, setConfig] = useState({
                aggressive: false,
                scopeValidation: true,
                autoSubmit: false,
                monitoring: false
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!target) {
                    alert('Please enter a target');
                    return;
                }
                
                onStart({
                    target,
                    platform,
                    program,
                    config: {
                        aggressive_testing: { enabled: config.aggressive },
                        scope_validation: { enabled: config.scopeValidation },
                        auto_submit: { enabled: config.autoSubmit },
                        continuous_monitoring: { enabled: config.monitoring }
                    }
                });
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
                        <h2 className="text-2xl font-bold mb-6">Start New Hunt</h2>
                        
                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Target Domain
                                </label>
                                <input
                                    type="text"
                                    value={target}
                                    onChange={(e) => setTarget(e.target.value)}
                                    placeholder="example.com"
                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Platform (Optional)
                                </label>
                                <select
                                    value={platform}
                                    onChange={(e) => setPlatform(e.target.value)}
                                    className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                >
                                    <option value="">No Platform</option>
                                    <option value="hackerone">HackerOne</option>
                                    <option value="bugcrowd">Bugcrowd</option>
                                </select>
                            </div>

                            {platform && (
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Program Handle
                                    </label>
                                    <input
                                        type="text"
                                        value={program}
                                        onChange={(e) => setProgram(e.target.value)}
                                        placeholder="program-handle"
                                        className="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                    />
                                </div>
                            )}

                            <div className="mb-6 space-y-3">
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={config.aggressive}
                                        onChange={(e) => setConfig({...config, aggressive: e.target.checked})}
                                        className="mr-2"
                                    />
                                    <span>Aggressive Mode (WAF Evasion)</span>
                                </label>
                                
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={config.scopeValidation}
                                        onChange={(e) => setConfig({...config, scopeValidation: e.target.checked})}
                                        className="mr-2"
                                    />
                                    <span>Scope Validation</span>
                                </label>
                                
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={config.autoSubmit}
                                        onChange={(e) => setConfig({...config, autoSubmit: e.target.checked})}
                                        className="mr-2"
                                    />
                                    <span>Auto-Submit High Confidence Findings</span>
                                </label>
                                
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={config.monitoring}
                                        onChange={(e) => setConfig({...config, monitoring: e.target.checked})}
                                        className="mr-2"
                                    />
                                    <span>Add to Continuous Monitoring</span>
                                </label>
                            </div>

                            <div className="flex space-x-4">
                                <button
                                    type="submit"
                                    className="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    Start Hunt
                                </button>
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors"
                                >
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // Hunt Card Component
        function HuntCard({ hunt }) {
            const [expanded, setExpanded] = useState(false);
            const [progress, setProgress] = useState(hunt.progress || 0);
            const [logs, setLogs] = useState([]);

            useEffect(() => {
                // Listen for progress updates
                socket.on('hunt_progress', (data) => {
                    if (data.hunt_id === hunt.id) {
                        setProgress(data.progress);
                    }
                });

                socket.on('hunt_log', (data) => {
                    if (data.hunt_id === hunt.id) {
                        setLogs(prev => [...prev, data].slice(-10));
                    }
                });

                return () => {
                    socket.off('hunt_progress');
                    socket.off('hunt_log');
                };
            }, [hunt.id]);

            return (
                <div className="bg-white rounded-lg shadow-lg p-6">
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <h3 className="text-xl font-semibold">{hunt.target}</h3>
                            <p className="text-gray-500">
                                {hunt.platform && `${hunt.platform} - ${hunt.program}`}
                            </p>
                        </div>
                        <div className="flex items-center space-x-2">
                            <span className={`px-3 py-1 rounded-full text-sm ${
                                hunt.status === 'running' ? 'bg-green-100 text-green-800' :
                                hunt.status === 'completed' ? 'bg-blue-100 text-blue-800' :
                                'bg-gray-100 text-gray-800'
                            }`}>
                                {hunt.status}
                            </span>
                            <button
                                onClick={() => setExpanded(!expanded)}
                                className="text-gray-500 hover:text-gray-700"
                            >
                                <i className={`fas fa-chevron-${expanded ? 'up' : 'down'}`}></i>
                            </button>
                        </div>
                    </div>

                    {/* Progress Bar */}
                    <div className="mb-4">
                        <div className="flex justify-between text-sm text-gray-600 mb-1">
                            <span>{hunt.phase || 'Initializing'}</span>
                            <span>{progress}%</span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2">
                            <div
                                className="bg-purple-600 h-2 rounded-full hunt-progress"
                                style="width: {{ progress }}%;"
                            ></div>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <p className="text-2xl font-semibold">{hunt.findings_count || 0}</p>
                            <p className="text-sm text-gray-500">Findings</p>
                        </div>
                        <div>
                            <p className="text-2xl font-semibold">{hunt.chains_count || 0}</p>
                            <p className="text-sm text-gray-500">Chains</p>
                        </div>
                        <div>
                            <p className="text-2xl font-semibold">{hunt.duration || '0'}m</p>
                            <p className="text-sm text-gray-500">Duration</p>
                        </div>
                    </div>

                    {/* Expanded View */}
                    {expanded && (
                        <div className="mt-6 pt-6 border-t">
                            <h4 className="font-semibold mb-3">Activity Log</h4>
                            <div className="bg-gray-50 rounded-lg p-4 max-h-48 overflow-y-auto">
                                {logs.map((log, index) => (
                                    <div key={index} className="text-sm mb-2">
                                        <span className="text-gray-500">{new Date(log.timestamp).toLocaleTimeString()}</span>
                                        <span className={`ml-2 ${
                                            log.level === 'ERROR' ? 'text-red-600' :
                                            log.level === 'WARNING' ? 'text-yellow-600' :
                                            'text-gray-700'
                                        }`}>
                                            {log.message}
                                        </span>
                                    </div>
                                ))}
                            </div>
                            
                            <div className="flex space-x-3 mt-4">
                                <button className="flex-1 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                    <i className="fas fa-download mr-2"></i>
                                    Download Reports
                                </button>
                                <button className="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300 transition-colors">
                                    <i className="fas fa-folder-open mr-2"></i>
                                    View Workspace
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Findings View Component
        function FindingsView() {
            const [findings, setFindings] = useState([]);
            const [filters, setFilters] = useState({
                severity: '',
                type: '',
                days: 30
            });

            useEffect(() => {
                fetchFindings();
            }, [filters]);

            const fetchFindings = async () => {
                const params = new URLSearchParams(filters);
                const response = await fetch(`${API_BASE}/findings?${params}`);
                const data = await response.json();
                if (data.success) {
                    setFindings(data.findings);
                }
            };

            return (
                <div>
                    <h1 className="text-3xl font-bold mb-8">Findings</h1>
                    
                    {/* Filters */}
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <select
                                value={filters.severity}
                                onChange={(e) => setFilters({...filters, severity: e.target.value})}
                                className="px-4 py-2 border rounded-lg"
                            >
                                <option value="">All Severities</option>
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                            
                            <select
                                value={filters.type}
                                onChange={(e) => setFilters({...filters, type: e.target.value})}
                                className="px-4 py-2 border rounded-lg"
                            >
                                <option value="">All Types</option>
                                <option value="XSS">XSS</option>
                                <option value="SQL Injection">SQL Injection</option>
                                <option value="SSRF">SSRF</option>
                                <option value="IDOR">IDOR</option>
                                <option value="RCE">RCE</option>
                            </select>
                            
                            <select
                                value={filters.days}
                                onChange={(e) => setFilters({...filters, days: e.target.value})}
                                className="px-4 py-2 border rounded-lg"
                            >
                                <option value="7">Last 7 days</option>
                                <option value="30">Last 30 days</option>
                                <option value="90">Last 90 days</option>
                                <option value="365">Last year</option>
                            </select>
                            
                            <button
                                onClick={fetchFindings}
                                className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                            >
                                <i className="fas fa-search mr-2"></i>
                                Search
                            </button>
                        </div>
                    </div>

                    {/* Findings Table */}
                    <div className="bg-white rounded-lg shadow-lg overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Type
                                    </th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Severity
                                    </th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Program
                                    </th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Amount
                                    </th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status
                                    </th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Date
                                    </th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {findings.map((finding) => (
                                    <tr key={finding.id} className="hover:bg-gray-50">
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className="text-sm font-medium text-gray-900">
                                                {finding.type}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                finding.severity === 'critical' ? 'bg-red-100 text-red-800' :
                                                finding.severity === 'high' ? 'bg-orange-100 text-orange-800' :
                                                finding.severity === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-green-100 text-green-800'
                                            }`}>
                                                {finding.severity}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {finding.program}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${finding.amount}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap">
                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                finding.status === 'paid' ? 'bg-green-100 text-green-800' :
                                                finding.status === 'accepted' ? 'bg-blue-100 text-blue-800' :
                                                'bg-gray-100 text-gray-800'
                                            }`}>
                                                {finding.status}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            {new Date(finding.date).toLocaleDateString()}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // Helper Components
        function LoadingSpinner() {
            return (
                <div className="flex justify-center items-center h-64">
                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"></div>
                </div>
            );
        }

        function StatCard({ title, value, icon, color }) {
            const colorClasses = {
                green: 'text-green-600 bg-green-100',
                blue: 'text-blue-600 bg-blue-100',
                purple: 'text-purple-600 bg-purple-100',
                orange: 'text-orange-600 bg-orange-100'
            };

            return (
                <div className="bg-white rounded-lg shadow-lg p-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <p className="text-sm text-gray-500">{title}</p>
                            <p className="text-2xl font-bold mt-1">{value}</p>
                        </div>
                        <div className={`p-3 rounded-full ${colorClasses[color]}`}>
                            <i className={`fas ${icon} text-xl`}></i>
                        </div>
                    </div>
                </div>
            );
        }

        function ActivityItem({ icon, title, description, time }) {
            return (
                <div className="flex items-start space-x-3">
                    <div className="flex-shrink-0">
                        <i className={`fas ${icon} text-purple-600`}></i>
                    </div>
                    <div className="flex-1">
                        <p className="font-medium">{title}</p>
                        <p className="text-sm text-gray-500">{description}</p>
                    </div>
                    <div className="text-sm text-gray-400">
                        {time}
                    </div>
                </div>
            );
        }

        // Chart Components
        function VulnTypeChart({ data }) {
            const canvasRef = useRef(null);

            useEffect(() => {
                if (!data || data.length === 0) return;

                const ctx = canvasRef.current.getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(item => item[0]),
                        datasets: [{
                            label: 'Earnings',
                            data: data.map(item => item[1]),
                            backgroundColor: 'rgba(139, 92, 246, 0.8)',
                            borderColor: 'rgba(139, 92, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        }
                    }
                });
            }, [data]);

            return <canvas ref={canvasRef} height="200"></canvas>;
        }

        function PlatformChart({ data }) {
            const canvasRef = useRef(null);

            useEffect(() => {
                if (!data || Object.keys(data).length === 0) return;

                const ctx = canvasRef.current.getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(data),
                        datasets: [{
                            data: Object.values(data),
                            backgroundColor: [
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(16, 185, 129, 0.8)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }, [data]);

            return <canvas ref={canvasRef} height="200"></canvas>;
        }

        // Revenue Analytics Component
        function RevenueAnalytics() {
            const [analytics, setAnalytics] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchAnalytics();
            }, []);

            const fetchAnalytics = async () => {
                try {
                    const response = await fetch(`${API_BASE}/revenue/analytics`);
                    const data = await response.json();
                    if (data.success) {
                        setAnalytics(data);
                    }
                } catch (error) {
                    console.error('Failed to fetch analytics:', error);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div>
                    <h1 className="text-3xl font-bold mb-8">Revenue Analytics</h1>
                    
                    {/* Revenue Overview */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-semibold mb-4">Total Earnings</h3>
                            <p className="text-4xl font-bold text-green-600">
                                ${analytics?.analytics?.total_earnings?.toFixed(2) || '0.00'}
                            </p>
                            <p className="text-sm text-gray-500 mt-2">Lifetime earnings</p>
                        </div>
                        
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-semibold mb-4">Average Hourly Rate</h3>
                            <p className="text-4xl font-bold text-blue-600">
                                ${analytics?.analytics?.hourly_rate?.toFixed(2) || '0.00'}
                            </p>
                            <p className="text-sm text-gray-500 mt-2">Per hour worked</p>
                        </div>
                        
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h3 className="text-lg font-semibold mb-4">Success Rate</h3>
                            <p className="text-4xl font-bold text-purple-600">
                                {(analytics?.analytics?.success_rate * 100)?.toFixed(1) || '0'}%
                            </p>
                            <p className="text-sm text-gray-500 mt-2">Accepted submissions</p>
                        </div>
                    </div>

                    {/* Monthly Trend Chart */}
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <h2 className="text-xl font-semibold mb-4">Monthly Earnings Trend</h2>
                        <MonthlyTrendChart data={analytics?.monthly_trend || []} />
                    </div>

                    {/* Best Programs */}
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h2 className="text-xl font-semibold mb-4">Top Earning Programs</h2>
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead>
                                    <tr className="border-b">
                                        <th className="text-left py-2">Program</th>
                                        <th className="text-left py-2">Platform</th>
                                        <th className="text-right py-2">Total Earnings</th>
                                        <th className="text-right py-2">Submissions</th>
                                        <th className="text-right py-2">Avg Bounty</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {analytics?.analytics?.best_programs?.map((program, index) => (
                                        <tr key={index} className="border-b">
                                            <td className="py-2">{program[0]}</td>
                                            <td className="py-2">{program[1]}</td>
                                            <td className="py-2 text-right">${program[2]?.toFixed(2)}</td>
                                            <td className="py-2 text-right">{program[3]}</td>
                                            <td className="py-2 text-right">${program[4]?.toFixed(2)}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        function MonthlyTrendChart({ data }) {
            const canvasRef = useRef(null);

            useEffect(() => {
                if (!data || data.length === 0) return;

                const ctx = canvasRef.current.getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(item => item.month),
                        datasets: [{
                            label: 'Monthly Earnings',
                            data: data.map(item => item.earnings),
                            borderColor: 'rgba(139, 92, 246, 1)',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value;
                                    }
                                }
                            }
                        }
                    }
                });
            }, [data]);

            return <canvas ref={canvasRef} height="300"></canvas>;
        }

        // Monitoring View Component  
        function MonitoringView() {
            const [targets, setTargets] = useState([]);
            const [changes, setChanges] = useState([]);
            const [showAddModal, setShowAddModal] = useState(false);

            useEffect(() => {
                fetchMonitoringData();
            }, []);

            const fetchMonitoringData = async () => {
                try {
                    const [targetsRes, changesRes] = await Promise.all([
                        fetch(`${API_BASE}/monitoring/targets`),
                        fetch(`${API_BASE}/monitoring/changes?hours=168`)
                    ]);
                    
                    const targetsData = await targetsRes.json();
                    const changesData = await changesRes.json();
                    
                    if (targetsData.success) setTargets(targetsData.targets);
                    if (changesData.success) setChanges(changesData.changes);
                } catch (error) {
                    console.error('Failed to fetch monitoring data:', error);
                }
            };

            return (
                <div>
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-3xl font-bold">Continuous Monitoring</h1>
                        <button
                            onClick={() => setShowAddModal(true)}
                            className="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors"
                        >
                            <i className="fas fa-plus mr-2"></i>
                            Add Target
                        </button>
                    </div>

                    {/* Monitored Targets */}
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <h2 className="text-xl font-semibold mb-4">Monitored Targets</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {targets.map((target, index) => (
                                <div key={index} className="border rounded-lg p-4">
                                    <div className="flex justify-between items-start mb-2">
                                        <h3 className="font-semibold">{target.target}</h3>
                                        <span className={`px-2 py-1 text-xs rounded-full ${
                                            target.enabled ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                        }`}>
                                            {target.enabled ? 'Active' : 'Paused'}
                                        </span>
                                    </div>
                                    <p className="text-sm text-gray-500 mb-1">
                                        Check every {target.frequency_hours} hours
                                    </p>
                                    <p className="text-sm text-gray-500">
                                        Last checked: {target.last_checked ? new Date(target.last_checked).toLocaleString() : 'Never'}
                                    </p>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Recent Changes */}
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h2 className="text-xl font-semibold mb-4">Recent Changes Detected</h2>
                        {changes.length === 0 ? (
                            <p className="text-gray-500">No changes detected in the last week</p>
                        ) : (
                            <div className="space-y-3">
                                {changes.map((change, index) => (
                                    <div key={index} className="border-l-4 border-purple-500 pl-4 py-2">
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <p className="font-medium">{change.target}</p>
                                                <p className="text-sm text-gray-600">{change.url}</p>
                                                <p className="text-sm text-gray-500">
                                                    {change.change_type} - {new Date(change.detected_at).toLocaleString()}
                                                </p>
                                            </div>
                                            {!change.tested && (
                                                <button className="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700">
                                                    Test Now
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // Settings View Component
        function SettingsView() {
            const [settings, setSettings] = useState(null);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                fetchSettings();
            }, []);

            const fetchSettings = async () => {
                try {
                    const response = await fetch(`${API_BASE}/settings`);
                    const data = await response.json();
                    if (data.success) {
                        setSettings(data);
                    }
                } catch (error) {
                    console.error('Failed to fetch settings:', error);
                } finally {
                    setLoading(false);
                }
            };

            const saveSettings = async () => {
                try {
                    const response = await fetch(`${API_BASE}/settings`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ config: settings.config })
                    });
                    const data = await response.json();
                    if (data.success) {
                        alert('Settings saved successfully!');
                    }
                } catch (error) {
                    console.error('Failed to save settings:', error);
                }
            };

            if (loading) return <LoadingSpinner />;

            return (
                <div>
                    <h1 className="text-3xl font-bold mb-8">Settings</h1>
                    
                    {/* API Keys Status */}
                    <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                        <h2 className="text-xl font-semibold mb-4">API Keys</h2>
                        <div className="space-y-3">
                            <div className="flex justify-between items-center">
                                <span>OpenAI API Key</span>
                                <span className={`px-3 py-1 rounded-full text-sm ${
                                    settings?.api_keys?.openai ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                }`}>
                                    {settings?.api_keys?.openai ? 'Configured' : 'Not Configured'}
                                </span>
                            </div>
                            <div className="flex justify-between items-center">
                                <span>HackerOne API</span>
                                <span className={`px-3 py-1 rounded-full text-sm ${
                                    settings?.api_keys?.hackerone ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                }`}>
                                    {settings?.api_keys?.hackerone ? 'Configured' : 'Optional'}
                                </span>
                            </div>
                            <div className="flex justify-between items-center">
                                <span>Bugcrowd API</span>
                                <span className={`px-3 py-1 rounded-full text-sm ${
                                    settings?.api_keys?.bugcrowd ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                }`}>
                                    {settings?.api_keys?.bugcrowd ? 'Configured' : 'Optional'}
                                </span>
                            </div>
                        </div>
                    </div>

                    {/* Configuration Settings */}
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        <h2 className="text-xl font-semibold mb-4">Configuration</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    OpenAI Model
                                </label>
                                <select
                                    value={settings?.config?.openai?.model || 'gpt-4'}
                                    onChange={(e) => setSettings({
                                        ...settings,
                                        config: {
                                            ...settings.config,
                                            openai: { ...settings.config.openai, model: e.target.value }
                                        }
                                    })}
                                    className="w-full px-4 py-2 border rounded-lg"
                                >
                                    <option value="gpt-4">GPT-4</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                </select>
                            </div>
                            
                            <div>
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={settings?.config?.aggressive_testing?.enabled || false}
                                        onChange={(e) => setSettings({
                                            ...settings,
                                            config: {
                                                ...settings.config,
                                                aggressive_testing: { enabled: e.target.checked }
                                            }
                                        })}
                                        className="mr-2"
                                    />
                                    <span>Enable Aggressive Testing by Default</span>
                                </label>
                            </div>
                            
                            <div>
                                <label className="flex items-center">
                                    <input
                                        type="checkbox"
                                        checked={settings?.config?.scope_validation?.enabled !== false}
                                        onChange={(e) => setSettings({
                                            ...settings,
                                            config: {
                                                ...settings.config,
                                                scope_validation: { enabled: e.target.checked }
                                            }
                                        })}
                                        className="mr-2"
                                    />
                                    <span>Enable Scope Validation</span>
                                </label>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Rate Limit Delay (seconds)
                                </label>
                                <input
                                    type="number"
                                    value={settings?.config?.rate_limiting?.base_delay || 1}
                                    onChange={(e) => setSettings({
                                        ...settings,
                                        config: {
                                            ...settings.config,
                                            rate_limiting: { 
                                                ...settings.config.rate_limiting, 
                                                base_delay: parseFloat(e.target.value) 
                                            }
                                        }
                                    })}
                                    className="w-full px-4 py-2 border rounded-lg"
                                    step="0.1"
                                    min="0.1"
                                />
                            </div>
                        </div>
                        
                        <button
                            onClick={saveSettings}
                            className="mt-6 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition-colors"
                        >
                            <i className="fas fa-save mr-2"></i>
                            Save Settings
                        </button>
                    </div>
                </div>
            );
        }

        // Utility Functions
        async function startNewHunt(huntData, addNotification) {
            try {
                const response = await fetch(`${API_BASE}/hunt/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(huntData)
                });
                
                const data = await response.json();
                if (data.success) {
                    addNotification('success', `Hunt started for ${huntData.target}`);
                    // Could refresh active hunts list here
                } else {
                    addNotification('error', data.error || 'Failed to start hunt');
                }
            } catch (error) {
                console.error('Failed to start hunt:', error);
                addNotification('error', 'Failed to start hunt');
            }
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
